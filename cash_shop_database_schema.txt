# Cash Shop Database Schema (MySQL)
## Requirements
- MySQL 8.x
- HeidiSQL / MySQL Workbench

---------------------------------------------------------------------------------------------------
## Database Creation
---------------------------------------------------------------------------------------------------
CREATE DATABASE IF NOT EXISTS cash_shop_db
CHARACTER SET utf8mb4
COLLATE utf8mb4_0900_ai_ci;

USE cash_shop_db;


CREATE TABLE users (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  cash BIGINT NOT NULL,
  created_at DATETIME(3),
  updated_at DATETIME(3),
  deleted_at DATETIME(3),
  INDEX idx_users_deleted_at (deleted_at)
) ENGINE=InnoDB;
INSERT INTO users (id, cash, created_at, updated_at)
VALUES (1, 10000, NOW(), NOW());



CREATE TABLE shop_items (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  code VARCHAR(50),
  name VARCHAR(100),
  type ENUM('PERMANENT','RENTAL'),
  base_price BIGINT,
  created_at DATETIME(3),
  updated_at DATETIME(3),
  deleted_at DATETIME(3),
  UNIQUE KEY idx_shop_items_code (code),
  INDEX idx_shop_items_deleted_at (deleted_at)
) ENGINE=InnoDB;
INSERT INTO shop_items (code, name, type, base_price, created_at, updated_at)
VALUES
('ITEM_A', 'Item A', 'PERMANENT', 1000, NOW(), NOW()),
('ITEM_B', 'Item B', 'RENTAL', NULL, NOW(), NOW());



CREATE TABLE shop_item_durations (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  shop_item_id BIGINT UNSIGNED,
  duration_key VARCHAR(10),
  seconds BIGINT,
  price BIGINT,
  created_at DATETIME(3),
  updated_at DATETIME(3),
  deleted_at DATETIME(3),
  INDEX idx_shop_item_durations_shop_item_id (shop_item_id),
  INDEX idx_shop_item_durations_deleted_at (deleted_at),
  CONSTRAINT fk_shop_items_durations
    FOREIGN KEY (shop_item_id) REFERENCES shop_items(id)
) ENGINE=InnoDB;
INSERT INTO shop_item_durations
(shop_item_id, duration_key, seconds, price, created_at, updated_at)
SELECT id, '1h', 3600, 100, NOW(), NOW() FROM shop_items WHERE code='ITEM_B'
UNION ALL
SELECT id, '6h', 21600, 500, NOW(), NOW() FROM shop_items WHERE code='ITEM_B'
UNION ALL
SELECT id, '1d', 86400, 1000, NOW(), NOW() FROM shop_items WHERE code='ITEM_B'
UNION ALL
SELECT id, '3d', 259200, 2000, NOW(), NOW() FROM shop_items WHERE code='ITEM_B'
UNION ALL
SELECT id, '7d', 604800, 4000, NOW(), NOW() FROM shop_items WHERE code='ITEM_B';



CREATE TABLE inventory_items (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  user_id BIGINT UNSIGNED,
  shop_item_id BIGINT UNSIGNED,
  acquired_at DATETIME(3),
  expire_at DATETIME(3),
  created_at DATETIME(3),
  updated_at DATETIME(3),
  deleted_at DATETIME(3),
  INDEX idx_inventory_items_user_id (user_id),
  INDEX idx_inventory_items_shop_item_id (shop_item_id),
  INDEX idx_inventory_items_deleted_at (deleted_at),
  CONSTRAINT fk_users_inventory_items
    FOREIGN KEY (user_id) REFERENCES users(id),
  CONSTRAINT fk_inventory_items_shop_item
    FOREIGN KEY (shop_item_id) REFERENCES shop_items(id)
) ENGINE=InnoDB;



CREATE TABLE purchase_logs (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  user_id BIGINT UNSIGNED,
  shop_item_id BIGINT UNSIGNED,
  duration_key VARCHAR(10),
  price_paid BIGINT,
  cash_before BIGINT,
  cash_after BIGINT,
  request_id VARCHAR(64),
  purchased_at DATETIME(3),
  created_at DATETIME(3),
  updated_at DATETIME(3),
  deleted_at DATETIME(3),
  INDEX idx_purchase_logs_user_id (user_id),
  INDEX idx_purchase_logs_shop_item_id (shop_item_id),
  INDEX idx_purchase_logs_request_id (request_id),
  INDEX idx_purchase_logs_deleted_at (deleted_at),
  CONSTRAINT fk_users_purchase_logs
    FOREIGN KEY (user_id) REFERENCES users(id),
  CONSTRAINT fk_purchase_logs_shop_item
    FOREIGN KEY (shop_item_id) REFERENCES shop_items(id)
) ENGINE=InnoDB;
